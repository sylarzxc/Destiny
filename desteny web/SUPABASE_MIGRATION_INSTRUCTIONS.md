# ІНСТРУКЦІЯ: Застосування міграції до Supabase

## Що потрібно зробити:

### 1. Відкрийте Supabase Dashboard
- Перейдіть на https://supabase.com/dashboard
- Виберіть ваш проект
- Перейдіть в розділ "SQL Editor"

### 2. Скопіюйте та виконайте міграційний скрипт
Скопіюйте весь вміст файлу `migration-fix-database.sql` і вставте в SQL Editor, потім натисніть "Run"

### 3. Перевірте результат
Після виконання скрипта ви повинні побачити:
- ✅ Створені таблиці: `referrals`, `wallets` (якщо не існували)
- ✅ Додані колонки до існуючих таблиць
- ✅ Створені RLS політики
- ✅ Створена функція `handle_new_user()`
- ✅ Створені початкові плани стейкінгу
- ✅ Додані демо-гаманці для існуючих користувачів

### 4. Перевірте таблиці
В розділі "Table Editor" перевірте, що існують:
- `profiles` (з колонкою `referral_code`)
- `wallets` (з колонками `user_id`, `currency`, `available`, `locked`)
- `referrals` (нова таблиця)
- `plans` (з колонкою `currency`)
- `transactions` (з додатковими колонками)
- `stakes` (з колонками `currency`, `flex_days`)

### 5. Перевірте дані
- В таблиці `wallets` повинні бути записи для всіх користувачів з демо-балансами
- В таблиці `plans` повинні бути 15 планів (по 3 для кожної криптовалюти)
- В таблиці `profiles` всі користувачі повинні мати `referral_code`

## Якщо виникнуть помилки:

### Помилка "table already exists"
- Це нормально, скрипт використовує `if not exists`
- Просто продовжуйте виконання

### Помилка "column already exists"
- Це означає, що колонка вже існує
- Скрипт використовує `if not exists`, тому помилка не критична

### Помилка "permission denied"
- Переконайтеся, що ви використовуєте правильний проект
- Перевірте, що у вас є права адміністратора

## Після застосування міграції:

1. **Оновіть сторінку** в браузері (Ctrl+F5)
2. **Перевірте консоль** - помилки повинні зникнути
3. **Перевірте дашборд** - повинні з'явитися всі криптовалютні картки
4. **Перевірте інші сторінки** - транзакції, реферали тощо

## Що зміниться:

- ✅ Зникнуть помилки "table not found"
- ✅ Зникнуть помилки "column not found"  
- ✅ Зникнуть помилки "foreign key relationship"
- ✅ З'являться всі 5 криптовалютних гаманців
- ✅ Працюватиме реферальна система
- ✅ Працюватимуть транзакції
- ✅ Працюватиме адмін-панель

## Контрольний список:

- [ ] Відкрив Supabase Dashboard
- [ ] Перейшов в SQL Editor
- [ ] Скопіював весь скрипт з `migration-fix-database.sql`
- [ ] Виконав скрипт (натиснув "Run")
- [ ] Перевірив, що немає критичних помилок
- [ ] Перевірив таблиці в Table Editor
- [ ] Оновив сторінку в браузері
- [ ] Перевірив дашборд - з'явилися всі криптовалютні картки
- [ ] Перевірив консоль - зникли помилки

## Якщо щось не працює:

1. **Перевірте консоль браузера** - які помилки залишилися
2. **Перевірте Supabase logs** - в розділі "Logs"
3. **Перевірте RLS policies** - в розділі "Authentication" > "Policies"
4. **Спробуйте вийти і зайти знову** - щоб оновити сесію

---

**ВАЖЛИВО**: Цей скрипт безпечний для виконання - він не видаляє існуючі дані, тільки додає нові таблиці та колонки.
